# Test time-domain state-space realization and simulation
@testset "State-space MIMO" begin
    poles = [
        -0.476190502929121 + 0im,
        -79206.4441574531 + 0im,
        -1017.76384177315 + 3595.99255890622im,
        -1017.76384177315 - 3595.99255890622im,
        -875.957351183041 + 14593.7841813509im,
        -875.957351183041 - 14593.7841813509im,
        -1550.45082287519 + 34852.3036229938im,
        -1550.45082287519 - 34852.3036229938im,
        -15280.2844768572 + 122345.044171754im,
        -15280.2844768572 - 122345.044171754im,
    ]

    R11 = [
        7.40987536702069e-14 + 0im,
        -198.785321394258 + 0im,
        0.219980455839476 + 0.215457612747253im,
        0.219980455839476 - 0.215457612747253im,
        81.6279911595347 + 6.47710195972654im,
        81.6279911595347 - 6.47710195972654im,
        333.260867183509 + 63.1092549627065im,
        333.260867183509 - 63.1092549627065im,
        4684.28382189821 + 239.040732309447im,
        4684.28382189821 - 239.040732309447im,
    ]
    R12 = [
        -2.15954408713931e-07 + 0im,
        -980.164975392196 + 0im,
        3.71765215165344 + 1.87852033203148im,
        3.71765215165344 - 1.87852033203148im,
        -105.402656273099 - 3.04541477612086im,
        -105.402656273099 + 3.04541477612086im,
        -111.883048304342 + 12.2553288771727im,
        -111.883048304342 - 12.2553288771727im,
        -3879.68279310344 - 1368.97367918464im,
        -3879.68279310344 + 1368.97367918464im,
    ]
    R22 = [
        47.6190547771491 + 0im,
        -4832.96941769953 + 0im,
        55.619118874847 + 9.01810901860201im,
        55.619118874847 - 9.01810901860201im,
        135.757522347641 - 2.90740586606814im,
        135.757522347641 + 2.90740586606814im,
        34.3218623196157 - 14.7282646981807im,
        34.3218623196157 + 14.7282646981807im,
        2921.31695569686 + 2118.58501483137im,
        2921.31695569686 - 2118.58501483137im,
    ]
    R = residues = zeros(ComplexF64, 2, 2, length(poles))
    for i in eachindex(poles)
        R[1, 1, i] = R11[i]
        R[1, 2, i] = R12[i]
        R[2, 1, i] = R12[i]
        R[2, 2, i] = R22[i]
    end

    # reduced complex state-space matrices
    A = diagm(
        [
            -0.476190502929121 + 0.0im
            -79206.4441574531 + 0.0im
            -1017.76384177315 + 3595.99255890622im
            -875.957351183041 + 14593.7841813509im
            -1550.45082287519 + 34852.3036229938im
            -15280.2844768572 + 122345.044171754im
            -0.476190502929121 + 0.0im
            -79206.4441574531 + 0.0im
            -1017.76384177315 + 3595.99255890622im
            -875.957351183041 + 14593.7841813509im
            -1550.45082287519 + 34852.3036229938im
            -15280.2844768572 + 122345.044171754im
        ],
    )

    B = [
        1.0 0.0
        1.0 0.0
        1.0 0.0
        1.0 0.0
        1.0 0.0
        1.0 0.0
        0.0 1.0
        0.0 1.0
        0.0 1.0
        0.0 1.0
        0.0 1.0
        0.0 1.0
    ]

    C = transpose(
        [
            7.40987536702069e-14+0.0im -2.15954408713931e-7+0.0im
            -198.785321394258+0.0im -980.164975392196+0.0im
            0.439960911678952+0.430915225494506im 7.43530430330688+3.75704066406296im
            163.2559823190694+12.95420391945308im -210.805312546198-6.09082955224172im
            666.521734367018+126.218509925413im -223.766096608684+24.5106577543454im
            9368.56764379642+478.081464618894im -7759.36558620688-2737.94735836928im
            -2.15954408713931e-7+0.0im 47.6190547771491+0.0im
            -980.164975392196+0.0im -4832.96941769953+0.0im
            7.43530430330688+3.75704066406296im 111.238237749694+18.03621803720402im
            -210.805312546198-6.09082955224172im 271.515044695282-5.81481173213628im
            -223.766096608684+24.5106577543454im 68.6437246392314-29.4565293963614im
            -7759.36558620688-2737.94735836928im 5842.63391139372+4237.17002966274im
        ],
    )

    D = [
        5.0 0.0
        0.0 0.0833333333333335
    ]

    E = [
        0.0 0.0
        0.0 2e-07
    ]

    am, bm, cm = symmetric_rational_to_state_space(
        poles,
        residues;
        real_only = false,
        reduced = true,
    )
    @test am == A
    @test bm == B
    @test cm == C
end
